version: '3'

services:

  react-app:
    build:
      context: react-app/
      dockerfile: Dockerfile
    ports:
      - 3000:80

    
    volumes:
    - ./react-app:/react-app   
    networks:
      - mongodb_network

  node-server: 
    build: 
      context: node-server/
      dockerfile: Dockerfile
    ports:
      - 8080:8080
    environment:
       MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME}
       MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD}
          
    networks:
      - mongodb_network

  mongodb:
      image: mongo:latest
      container_name: mongodb
      restart: always
      ports:
      - 27017:27017
      environment:   
           MONGO_INITDB_ROOT_USERNAME: ${MONGO_INITDB_ROOT_USERNAME}
           MONGO_INITDB_ROOT_PASSWORD: ${MONGO_INITDB_ROOT_PASSWORD}
          
      volumes:
      - mongodb:/data/db/
      networks: 
      - mongodb_network
  

  nginx:
    image: nginx
    ports:
      - 80:80
    volumes:
        - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
     - react-app

volumes:
  mongodb:
    driver: local
    name: mongodb
networks:
  mongodb_network:
    driver: bridge
    name: mongodb_network
